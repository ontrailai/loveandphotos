import{c as A,u as K,a as Q,r as D,s as Z,z as ee,j as e,L as E,B as _,C as M,b as k,d as H,S as U,e as F,f as se,M as te,g as ae,R as re,D as ne}from"./index-CaG_q31Y.js";import{A as W}from"./Avatar-DfDAg1Qg.js";import{i as ie,a as P,C as le}from"./index-IqPYQfMU.js";import{I as ce}from"./image-B_iS4Rxw.js";import{r as p,t as m,g as de,l as oe,a as $,f as G}from"./index-DhHBP2zF.js";const me=A("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),ue=A("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]),he=A("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);function I(a,t){p(2,arguments);var r=m(a),c=m(t),u=r.getTime()-c.getTime();return u<0?-1:u>0?1:u}function xe(a,t){p(2,arguments);var r=m(a),c=m(t),u=r.getFullYear()-c.getFullYear(),x=r.getMonth()-c.getMonth();return u*12+x}function fe(a,t){return p(2,arguments),m(a).getTime()-m(t).getTime()}var ve={ceil:Math.ceil,round:Math.round,floor:Math.floor,trunc:function(t){return t<0?Math.ceil(t):Math.floor(t)}},ge="trunc";function je(a){return ve[ge]}function pe(a){p(1,arguments);var t=m(a);return t.setHours(23,59,59,999),t}function Ne(a){p(1,arguments);var t=m(a),r=t.getMonth();return t.setFullYear(t.getFullYear(),r+1,0),t.setHours(23,59,59,999),t}function ye(a){p(1,arguments);var t=m(a);return pe(t).getTime()===Ne(t).getTime()}function we(a,t){p(2,arguments);var r=m(a),c=m(t),u=I(r,c),x=Math.abs(xe(r,c)),n;if(x<1)n=0;else{r.getMonth()===1&&r.getDate()>27&&r.setDate(30),r.setMonth(r.getMonth()-u*x);var j=I(r,c)===-u;ye(m(a))&&x===1&&I(a,c)===1&&(j=!1),n=u*(x-Number(j))}return n===0?0:n}function be(a,t,r){p(2,arguments);var c=fe(a,t)/1e3;return je()(c)}function J(a,t){if(a==null)throw new TypeError("assign requires that input parameter not be null or undefined");for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(a[r]=t[r]);return a}function _e(a){return J({},a)}var V=1440,Me=2520,q=43200,De=86400;function Se(a,t,r){var c,u;p(2,arguments);var x=de(),n=(c=(u=r==null?void 0:r.locale)!==null&&u!==void 0?u:x.locale)!==null&&c!==void 0?c:oe;if(!n.formatDistance)throw new RangeError("locale must contain formatDistance property");var j=I(a,t);if(isNaN(j))throw new RangeError("Invalid time value");var i=J(_e(r),{addSuffix:!!(r!=null&&r.addSuffix),comparison:j}),w,y;j>0?(w=m(t),y=m(a)):(w=m(a),y=m(t));var f=be(y,w),z=($(y)-$(w))/1e3,d=Math.round((f-z)/60),N;if(d<2)return r!=null&&r.includeSeconds?f<5?n.formatDistance("lessThanXSeconds",5,i):f<10?n.formatDistance("lessThanXSeconds",10,i):f<20?n.formatDistance("lessThanXSeconds",20,i):f<40?n.formatDistance("halfAMinute",0,i):f<60?n.formatDistance("lessThanXMinutes",1,i):n.formatDistance("xMinutes",1,i):d===0?n.formatDistance("lessThanXMinutes",1,i):n.formatDistance("xMinutes",d,i);if(d<45)return n.formatDistance("xMinutes",d,i);if(d<90)return n.formatDistance("aboutXHours",1,i);if(d<V){var B=Math.round(d/60);return n.formatDistance("aboutXHours",B,i)}else{if(d<Me)return n.formatDistance("xDays",1,i);if(d<q){var O=Math.round(d/V);return n.formatDistance("xDays",O,i)}else if(d<De)return N=Math.round(d/q),n.formatDistance("aboutXMonths",N,i)}if(N=we(y,w),N<12){var s=Math.round(d/q);return n.formatDistance("xMonths",s,i)}else{var o=N%12,l=Math.floor(N/12);return o<3?n.formatDistance("aboutXYears",l,i):o<9?n.formatDistance("overXYears",l,i):n.formatDistance("almostXYears",l+1,i)}}function Te(a,t){return p(1,arguments),Se(a,Date.now(),t)}const Be=()=>{const{user:a,profile:t}=K(),r=Q(),[c,u]=D.useState([]),[x,n]=D.useState([]),[j,i]=D.useState([]),[w,y]=D.useState(!0),[f,z]=D.useState({totalBookings:0,upcomingEvents:0,photosReceived:0,reviewsGiven:0});D.useEffect(()=>{a&&d()},[a]);const d=async()=>{try{y(!0);const{data:s,error:o}=await Z.from("bookings").select(`
          *,
          photographers (
            id,
            users!inner (
              full_name,
              avatar_url,
              phone,
              email
            ),
            pay_tiers (
              name,
              badge_color
            ),
            average_rating,
            total_reviews
          ),
          packages (
            title,
            duration_minutes
          ),
          job_queue (
            upload_status,
            delivery_url,
            delivered_at
          ),
          reviews (
            id,
            rating,
            comment
          )
        `).eq("customer_id",a.id).order("event_date",{ascending:!1});if(!o&&s){u(s);const l=s.filter(h=>ie(new Date(h.event_date))),b=s.filter(h=>P(new Date(h.event_date)));n(l),i(b),z({totalBookings:s.length,upcomingEvents:l.length,photosReceived:s.filter(h=>{var v,g;return((g=(v=h.job_queue)==null?void 0:v[0])==null?void 0:g.upload_status)==="completed"}).length,reviewsGiven:s.filter(h=>{var v,g;return(g=(v=h.reviews)==null?void 0:v[0])==null?void 0:g.id}).length})}}catch(s){console.error("Error loading dashboard:",s),ee.error("Failed to load dashboard data")}finally{y(!1)}},N=s=>{var o,l;return s.booking_status==="cancelled"?{label:"Cancelled",variant:"danger"}:((l=(o=s.job_queue)==null?void 0:o[0])==null?void 0:l.upload_status)==="completed"?{label:"Delivered",variant:"success"}:P(new Date(s.event_date))?{label:"Completed",variant:"secondary"}:s.payment_status==="paid"?{label:"Confirmed",variant:"primary"}:{label:"Pending",variant:"warning"}},B=s=>{r(`/review/${s.id}`)},O=s=>{var o,l;(l=(o=s.job_queue)==null?void 0:o[0])!=null&&l.delivery_url&&window.open(s.job_queue[0].delivery_url,"_blank")};return w?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blush-500"})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-display font-bold text-dusty-900",children:["Welcome back",t!=null&&t.full_name?`, ${t.full_name.split(" ")[0]}`:"","!"]}),e.jsx("p",{className:"text-dusty-600 mt-1",children:"Manage your bookings and discover new photographers"})]}),e.jsx(E,{to:"/browse",children:e.jsxs(_,{children:[e.jsx(he,{className:"w-5 h-5 mr-2"}),"Book Photographer"]})})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[e.jsx(M,{className:"bg-gradient-to-br from-blush-50 to-blush-100 border-blush-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-blush-600 text-sm font-medium",children:"Total Bookings"}),e.jsx("p",{className:"text-3xl font-bold text-blush-900",children:f.totalBookings})]}),e.jsx("div",{className:"w-12 h-12 bg-blush-500 rounded-lg flex items-center justify-center",children:e.jsx(k,{className:"w-6 h-6 text-white"})})]})}),e.jsx(M,{className:"bg-gradient-to-br from-sage-50 to-sage-100 border-sage-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sage-600 text-sm font-medium",children:"Upcoming Events"}),e.jsx("p",{className:"text-3xl font-bold text-sage-900",children:f.upcomingEvents})]}),e.jsx("div",{className:"w-12 h-12 bg-sage-500 rounded-lg flex items-center justify-center",children:e.jsx(H,{className:"w-6 h-6 text-white"})})]})}),e.jsx(M,{className:"bg-gradient-to-br from-dusty-50 to-dusty-100 border-dusty-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-dusty-600 text-sm font-medium",children:"Photos Received"}),e.jsx("p",{className:"text-3xl font-bold text-dusty-900",children:f.photosReceived})]}),e.jsx("div",{className:"w-12 h-12 bg-dusty-500 rounded-lg flex items-center justify-center",children:e.jsx(ce,{className:"w-6 h-6 text-white"})})]})}),e.jsx(M,{className:"bg-gradient-to-br from-yellow-50 to-yellow-100 border-yellow-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-yellow-600 text-sm font-medium",children:"Reviews Given"}),e.jsx("p",{className:"text-3xl font-bold text-yellow-900",children:f.reviewsGiven})]}),e.jsx("div",{className:"w-12 h-12 bg-yellow-500 rounded-lg flex items-center justify-center",children:e.jsx(U,{className:"w-6 h-6 text-white"})})]})})]}),x.length>0&&e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-semibold text-dusty-900 mb-4",children:"Upcoming Events"}),e.jsx("div",{className:"grid gap-4",children:x.map(s=>{var o,l,b,h,v,g,S,T,C,R,X,L,Y;return e.jsxs(M,{className:"overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(W,{src:(l=(o=s.photographers)==null?void 0:o.users)==null?void 0:l.avatar_url,name:(h=(b=s.photographers)==null?void 0:b.users)==null?void 0:h.full_name,size:"lg"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx("h3",{className:"font-semibold text-dusty-900",children:(g=(v=s.photographers)==null?void 0:v.users)==null?void 0:g.full_name}),e.jsx(F,{variant:((C=(T=(S=s.photographers)==null?void 0:S.pay_tiers)==null?void 0:T.name)==null?void 0:C.toLowerCase())||"default",size:"sm",children:(X=(R=s.photographers)==null?void 0:R.pay_tiers)==null?void 0:X.name}),e.jsx(F,{variant:N(s).variant,size:"sm",children:N(s).label})]}),e.jsxs("p",{className:"text-sm text-dusty-600 mb-2",children:[(L=s.packages)==null?void 0:L.title," • ",(Y=s.packages)==null?void 0:Y.duration_minutes," minutes"]}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-dusty-600",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(H,{className:"w-4 h-4 mr-1"}),G(new Date(s.event_date),"MMM dd, yyyy")]}),e.jsxs("span",{className:"flex items-center",children:[e.jsx(se,{className:"w-4 h-4 mr-1"}),s.event_time]}),e.jsxs("span",{className:"flex items-center",children:[e.jsx(te,{className:"w-4 h-4 mr-1"}),s.venue_name]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(_,{variant:"ghost",size:"sm",children:[e.jsx(ue,{className:"w-4 h-4 mr-2"}),"Message"]}),e.jsx(E,{to:`/booking/${s.id}`,children:e.jsxs(_,{variant:"outline",size:"sm",children:["View Details",e.jsx(le,{className:"w-4 h-4 ml-2"})]})})]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-dusty-600",children:["Event in ",Te(new Date(s.event_date),{addSuffix:!1})]}),s.contract_signed_at?e.jsxs("span",{className:"flex items-center text-sm text-green-600",children:[e.jsx(ae,{className:"w-4 h-4 mr-1"}),"Contract signed"]}):e.jsxs("span",{className:"flex items-center text-sm text-yellow-600",children:[e.jsx(me,{className:"w-4 h-4 mr-1"}),"Contract pending"]})]})})]},s.id)})})]}),j.length>0&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-dusty-900 mb-4",children:"Past Events"}),e.jsx("div",{className:"grid gap-4",children:j.slice(0,5).map(s=>{var o,l,b,h,v,g,S,T,C,R;return e.jsx(M,{className:"bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(W,{src:(l=(o=s.photographers)==null?void 0:o.users)==null?void 0:l.avatar_url,name:(h=(b=s.photographers)==null?void 0:b.users)==null?void 0:h.full_name,size:"md"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-dusty-900",children:(g=(v=s.photographers)==null?void 0:v.users)==null?void 0:g.full_name}),e.jsxs("p",{className:"text-sm text-dusty-600",children:[s.event_type," • ",G(new Date(s.event_date),"MMM dd, yyyy")]}),(S=s.reviews)!=null&&S[0]?e.jsx("div",{className:"mt-1",children:e.jsx(re,{rating:s.reviews[0].rating,size:"sm"})}):e.jsx("p",{className:"text-sm text-blush-600 mt-1",children:"Review pending"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[((C=(T=s.job_queue)==null?void 0:T[0])==null?void 0:C.upload_status)==="completed"&&e.jsxs(_,{variant:"outline",size:"sm",onClick:()=>O(s),children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),"Photos"]}),!((R=s.reviews)!=null&&R[0])&&P(new Date(s.event_date))&&e.jsxs(_,{size:"sm",onClick:()=>B(s),children:[e.jsx(U,{className:"w-4 h-4 mr-2"}),"Write Review"]})]})]})},s.id)})}),j.length>5&&e.jsx("div",{className:"text-center mt-6",children:e.jsx(E,{to:"/my-bookings",children:e.jsx(_,{variant:"outline",children:"View All Bookings"})})})]}),c.length===0&&e.jsxs(M,{className:"text-center py-12",children:[e.jsx(k,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-dusty-900 mb-2",children:"No bookings yet"}),e.jsx("p",{className:"text-dusty-600 mb-6 max-w-md mx-auto",children:"Start your journey by finding the perfect photographer for your special moments"}),e.jsx(E,{to:"/photographers",children:e.jsx(_,{size:"lg",children:"Browse Photographers"})})]})]})]})};export{Be as default};
