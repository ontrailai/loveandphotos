import{c as re,u as ne,a as ie,r as y,s as G,z as C,j as e,B as h,C as g,k as w,d as K,p as de,b as oe,f as ce,M as ue,F as me,e as z,g as xe}from"./index-BFYXmv0n.js";import{A as pe}from"./Avatar-CccbZ3Wz.js";import{i as he,a as M,C as ge}from"./index-CXy4b6br.js";import{U as J}from"./upload-BkQ_1iUH.js";import{r as A,t as T,a as W,f as fe}from"./index-DhHBP2zF.js";const ve=re("Package",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]);function X(r){A(1,arguments);var a=T(r);return a.setHours(0,0,0,0),a}var ye=864e5;function je(r,a){A(2,arguments);var l=X(r),u=X(a),m=l.getTime()-W(l),f=u.getTime()-W(u);return Math.round((m-f)/ye)}function ee(r,a){var l=r.getFullYear()-a.getFullYear()||r.getMonth()-a.getMonth()||r.getDate()-a.getDate()||r.getHours()-a.getHours()||r.getMinutes()-a.getMinutes()||r.getSeconds()-a.getSeconds()||r.getMilliseconds()-a.getMilliseconds();return l<0?-1:l>0?1:l}function Ne(r,a){A(2,arguments);var l=T(r),u=T(a),m=ee(l,u),f=Math.abs(je(l,u));l.setDate(l.getDate()-m*f);var q=+(ee(l,u)===-m),i=m*(f-q);return i===0?0:i}const ke=()=>{var F,I,P,$,E;const{user:r,photographerProfile:a}=ne(),l=ie(),[u,m]=y.useState([]),[f,q]=y.useState(!0),[i,S]=y.useState(null),[x,U]=y.useState("all"),[D,se]=y.useState({total:0,upcoming:0,overdue:0,readyToUpload:0});y.useEffect(()=>{a!=null&&a.id&&O()},[a,x]);const O=async()=>{try{q(!0);let s=G.from("bookings").select(`
          *,
          customer:users!customer_id (
            full_name,
            email,
            phone,
            avatar_url
          ),
          packages (
            title,
            duration_minutes,
            deliverables
          ),
          job_queue!inner (
            id,
            upload_status,
            overtime_logged,
            delivery_url,
            deadline,
            delivered_at,
            notes
          )
        `).eq("photographer_id",a.id).order("event_date",{ascending:!0});x==="upcoming"?(s=s.gte("event_date",new Date().toISOString()),s=s.neq("job_queue.upload_status","completed")):x==="overdue"?(s=s.lt("job_queue.deadline",new Date().toISOString()),s=s.neq("job_queue.upload_status","completed")):x==="completed"&&(s=s.eq("job_queue.upload_status","completed"));const{data:t,error:n}=await s;if(n)throw n;if(t){m(t);const v=t.filter(d=>{var o,c;return he(new Date(d.event_date))&&((c=(o=d.job_queue)==null?void 0:o[0])==null?void 0:c.upload_status)!=="completed"}),p=t.filter(d=>{var c,j,N,_;const o=(j=(c=d.job_queue)==null?void 0:c[0])==null?void 0:j.deadline;return o&&M(new Date(o))&&((_=(N=d.job_queue)==null?void 0:N[0])==null?void 0:_.upload_status)!=="completed"}),k=t.filter(d=>{var o,c;return M(new Date(d.event_date))&&((c=(o=d.job_queue)==null?void 0:o[0])==null?void 0:c.upload_status)==="pending"});se({total:t.length,upcoming:v.length,overdue:p.length,readyToUpload:k.length})}}catch(s){console.error("Error loading jobs:",s),C.error("Failed to load job queue")}finally{q(!1)}},te=async(s,t)=>{try{const{error:n}=await G.from("job_queue").update({upload_status:"in_progress",updated_at:new Date().toISOString()}).eq("id",s);if(n)throw n;C.success("Job marked as ready to upload"),O(),l(`/dashboard/photographer/uploads?job=${s}&booking=${t}`)}catch(n){console.error("Error updating job status:",n),C.error("Failed to update job status")}},ae=s=>{var v,p;if(!((p=(v=s.job_queue)==null?void 0:v[0])!=null&&p.deadline))return null;const t=new Date(s.job_queue[0].deadline),n=Ne(t,new Date);return s.job_queue[0].upload_status==="completed"?{type:"success",label:"Delivered"}:M(t)?{type:"danger",label:`${Math.abs(n)} days overdue`}:n<=3?{type:"warning",label:`Due in ${n} days`}:{type:"default",label:`Due in ${n} days`}},le=s=>{var t;(t=s.personalization_data)!=null&&t.quizCompleted?S(s):C.info("Client has not completed the style quiz yet")};return f?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blush-500"})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-display font-bold text-dusty-900",children:"Job Queue"}),e.jsx("p",{className:"text-dusty-600 mt-1",children:"Manage your upcoming photography sessions"})]}),e.jsxs(h,{onClick:()=>l("/dashboard/photographer/uploads"),children:[e.jsx(J,{className:"w-5 h-5 mr-2"}),"Upload Center"]})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[e.jsx(g,{className:w("cursor-pointer transition-all",x==="all"&&"ring-2 ring-blush-500"),onClick:()=>U("all"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-dusty-600 text-sm",children:"Total Jobs"}),e.jsx("p",{className:"text-2xl font-bold text-dusty-900",children:D.total})]}),e.jsx(ve,{className:"w-8 h-8 text-dusty-400"})]})}),e.jsx(g,{className:w("cursor-pointer transition-all",x==="upcoming"&&"ring-2 ring-blush-500"),onClick:()=>U("upcoming"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-600 text-sm",children:"Upcoming"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:D.upcoming})]}),e.jsx(K,{className:"w-8 h-8 text-blue-400"})]})}),e.jsx(g,{className:w("cursor-pointer transition-all",x==="overdue"&&"ring-2 ring-blush-500"),onClick:()=>U("overdue"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-red-600 text-sm",children:"Overdue"}),e.jsx("p",{className:"text-2xl font-bold text-red-900",children:D.overdue})]}),e.jsx(de,{className:"w-8 h-8 text-red-400"})]})}),e.jsx(g,{className:"bg-gradient-to-br from-green-50 to-green-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-green-600 text-sm",children:"Ready to Upload"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:D.readyToUpload})]}),e.jsx(J,{className:"w-8 h-8 text-green-500"})]})})]}),e.jsx("div",{className:"space-y-4",children:u.length===0?e.jsxs(g,{className:"text-center py-12",children:[e.jsx(oe,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-dusty-900 mb-2",children:"No jobs in queue"}),e.jsx("p",{className:"text-dusty-600 max-w-md mx-auto",children:"Jobs will appear here once clients book your services"})]}):u.map(s=>{var p,k,d,o,c,j,N,_,H,B,L,V,Y,Q,R,Z;const t=ae(s),n=(t==null?void 0:t.type)==="danger",v=M(new Date(s.event_date));return e.jsx(g,{className:w("transition-all",n&&"border-red-200 bg-red-50"),children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx(pe,{src:(p=s.customer)==null?void 0:p.avatar_url,name:(k=s.customer)==null?void 0:k.full_name,size:"lg"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-dusty-900",children:(d=s.customer)==null?void 0:d.full_name}),e.jsxs("p",{className:"text-sm text-dusty-600",children:[s.event_type," ‚Ä¢ ",(o=s.packages)==null?void 0:o.title]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center text-sm text-dusty-600",children:[e.jsx(K,{className:"w-4 h-4 mr-2 text-dusty-400"}),fe(new Date(s.event_date),"MMM dd, yyyy")]}),e.jsxs("div",{className:"flex items-center text-sm text-dusty-600",children:[e.jsx(ce,{className:"w-4 h-4 mr-2 text-dusty-400"}),s.event_time," ‚Ä¢ ",(c=s.packages)==null?void 0:c.duration_minutes," min"]}),e.jsxs("div",{className:"flex items-center text-sm text-dusty-600",children:[e.jsx(ue,{className:"w-4 h-4 mr-2 text-dusty-400"}),s.venue_name]})]}),s.venue_address&&e.jsx("div",{className:"bg-gray-50 rounded-lg p-3 mb-4",children:e.jsxs("p",{className:"text-sm text-dusty-700",children:[s.venue_address.street,", ",s.venue_address.city,", ",s.venue_address.state," ",s.venue_address.zip]})}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[((j=s.personalization_data)==null?void 0:j.quizCompleted)&&e.jsxs(h,{variant:"outline",size:"sm",onClick:()=>le(s),children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),"View Style Preferences"]}),e.jsxs(h,{variant:"ghost",size:"sm",onClick:()=>{var b;return window.location.href=`tel:${(b=s.customer)==null?void 0:b.phone}`},children:["üìû ",(N=s.customer)==null?void 0:N.phone]}),e.jsxs(h,{variant:"ghost",size:"sm",onClick:()=>{var b;return window.location.href=`mailto:${(b=s.customer)==null?void 0:b.email}`},children:["‚úâÔ∏è ",(_=s.customer)==null?void 0:_.email]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[t&&e.jsx(z,{variant:t.type,className:w(t.type==="danger"&&"animate-pulse"),children:t.label}),((B=(H=s.job_queue)==null?void 0:H[0])==null?void 0:B.upload_status)&&e.jsx(z,{variant:s.job_queue[0].upload_status==="completed"?"success":s.job_queue[0].upload_status==="in_progress"?"warning":"default",children:s.job_queue[0].upload_status==="completed"?"Delivered":s.job_queue[0].upload_status==="in_progress"?"Uploading":"Pending"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[v&&((V=(L=s.job_queue)==null?void 0:L[0])==null?void 0:V.upload_status)==="pending"&&e.jsxs(h,{onClick:()=>te(s.job_queue[0].id,s.id),size:"sm",children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Start Upload"]}),((Q=(Y=s.job_queue)==null?void 0:Y[0])==null?void 0:Q.upload_status)==="in_progress"&&e.jsxs(h,{onClick:()=>l(`/dashboard/photographer/uploads?job=${s.job_queue[0].id}&booking=${s.id}`),variant:"outline",size:"sm",children:["Continue Upload",e.jsx(ge,{className:"w-4 h-4 ml-2"})]}),((Z=(R=s.job_queue)==null?void 0:R[0])==null?void 0:Z.upload_status)==="completed"&&e.jsxs(z,{variant:"success",className:"px-3 py-1",children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),"Delivered"]})]})]})]})]})})},s.id)})})]}),i&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs(g,{className:"max-w-2xl w-full max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-xl font-semibold text-dusty-900",children:["Style Preferences for ",(F=i.customer)==null?void 0:F.full_name]}),e.jsx("button",{onClick:()=>S(null),className:"text-dusty-400 hover:text-dusty-600",children:"‚úï"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-dusty-900 mb-2",children:"Photography Style"}),e.jsx("p",{className:"text-dusty-600",children:((I=i.personalization_data)==null?void 0:I.style)||"Not specified"})]}),((P=i.personalization_data)==null?void 0:P.shots)&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-dusty-900 mb-2",children:"Must-Have Shots"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:i.personalization_data.shots.map((s,t)=>e.jsx(z,{variant:"secondary",children:s},t))})]}),(($=i.personalization_data)==null?void 0:$.musicMood)&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-dusty-900 mb-2",children:"Video Music Mood"}),e.jsx("p",{className:"text-dusty-600",children:i.personalization_data.musicMood})]}),((E=i.personalization_data)==null?void 0:E.notes)&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-dusty-900 mb-2",children:"Special Notes"}),e.jsx("p",{className:"text-dusty-600 bg-gray-50 rounded-lg p-4",children:i.personalization_data.notes})]})]}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx(h,{onClick:()=>S(null),children:"Close"})})]})})]})};export{ke as default};
